!function(e,t,n){function a(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function o(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return p[e.which]?p[e.which]:f[e.which]?f[e.which]:String.fromCharCode(e.which).toLowerCase()}function i(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function r(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function s(e,t){var n,a,o,i=[];for(n=e,"+"===n?n=["+"]:(n=n.replace(/\+{2}/g,"+plus"),n=n.split("+")),o=0;o<n.length;++o)a=n[o],h[a]&&(a=h[a]),t&&"keypress"!=t&&d[a]&&(a=d[a],i.push("shift")),r(a)&&i.push(a);if(n=a,o=t,!o){if(!u){u={};for(var s in p)s>95&&112>s||p.hasOwnProperty(s)&&(u[p[s]]=s)}o=u[n]?"keydown":"keypress"}return"keypress"==o&&i.length&&(o="keydown"),{key:a,modifiers:i,action:o}}function c(e,n){return null===e||e===t?!1:e===n?!0:c(e.parentNode,n)}function l(e){function n(e){e=e||{};var t,n=!1;for(t in y)e[t]?n=!0:y[t]=0;n||(k=!1)}function c(e,t,n,a,o,i){var s,c,l=[],u=n.type;if(!h._callbacks[e])return[];for("keyup"==u&&r(e)&&(t=[e]),s=0;s<h._callbacks[e].length;++s)if(c=h._callbacks[e][s],(a||!c.seq||y[c.seq]==c.level)&&u==c.action){var p;(p="keypress"==u&&!n.metaKey&&!n.ctrlKey)||(p=c.modifiers,p=t.sort().join(",")===p.sort().join(",")),p&&(p=a&&c.seq==a&&c.level==i,(!a&&c.combo==o||p)&&h._callbacks[e].splice(s,1),l.push(c))}return l}function u(e,t,n,a){h.stopCallback(t,t.target||t.srcElement,n,a)||!1!==e(t,n)||(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation?t.stopPropagation():t.cancelBubble=!0)}function p(e){"number"!=typeof e.which&&(e.which=e.keyCode);var t=o(e);t&&("keyup"==e.type&&g===t?g=!1:h.handleKey(t,i(e),e))}function f(e,t,a,i){function r(t){return function(){k=t,++y[e],clearTimeout(m),m=setTimeout(n,1e3)}}function c(t){u(a,t,e),"keyup"!==i&&(g=o(t)),setTimeout(n,10)}for(var l=y[e]=0;l<t.length;++l){var p=l+1===t.length?c:r(i||s(t[l+1]).action);d(t[l],p,i,e,l)}}function d(e,t,n,a,o){h._directMap[e+":"+n]=t,e=e.replace(/\s+/g," ");var i=e.split(" ");1<i.length?f(e,i,t,n):(n=s(e,n),h._callbacks[n.key]=h._callbacks[n.key]||[],c(n.key,n.modifiers,{type:n.action},a,e,o),h._callbacks[n.key][a?"unshift":"push"]({callback:t,modifiers:n.modifiers,action:n.action,seq:a,level:o,combo:e}))}var h=this;if(e=e||t,!(h instanceof l))return new l(e);h.target=e,h._callbacks={},h._directMap={};var m,y={},g=!1,v=!1,k=!1;h._handleKey=function(e,t,a){var o,i=c(e,t,a);t={};var s=0,l=!1;for(o=0;o<i.length;++o)i[o].seq&&(s=Math.max(s,i[o].level));for(o=0;o<i.length;++o)i[o].seq?i[o].level==s&&(l=!0,t[i[o].seq]=1,u(i[o].callback,a,i[o].combo,i[o].seq)):l||u(i[o].callback,a,i[o].combo);i="keypress"==a.type&&v,a.type!=k||r(e)||i||n(t),v=l&&"keydown"==a.type},h._bindMultiple=function(e,t,n){for(var a=0;a<e.length;++a)d(e[a],t,n)},a(e,"keypress",p),a(e,"keydown",p),a(e,"keyup",p)}var u,p={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},f={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},d={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},h={option:"alt",command:"meta","return":"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"};for(n=1;20>n;++n)p[111+n]="f"+n;for(n=0;9>=n;++n)p[n+96]=n;l.prototype.bind=function(e,t,n){return e=e instanceof Array?e:[e],this._bindMultiple.call(this,e,t,n),this},l.prototype.unbind=function(e,t){return this.bind.call(this,e,function(){},t)},l.prototype.trigger=function(e,t){return this._directMap[e+":"+t]&&this._directMap[e+":"+t]({},e),this},l.prototype.reset=function(){return this._callbacks={},this._directMap={},this},l.prototype.stopCallback=function(e,t){return-1<(" "+t.className+" ").indexOf(" mousetrap ")||c(t,this.target)?!1:"INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable},l.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},l.init=function(){var e,n=l(t);for(e in n)"_"!==e.charAt(0)&&(l[e]=function(e){return function(){return n[e].apply(n,arguments)}}(e))},l.init(),e.Mousetrap=l,"undefined"!=typeof module&&module.exports&&(module.exports=l),"function"==typeof define&&define.amd&&define(function(){return l})}(window,document);