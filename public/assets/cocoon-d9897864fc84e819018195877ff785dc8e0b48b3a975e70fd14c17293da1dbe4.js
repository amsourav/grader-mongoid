!function(e){var n=0,t=function(){return(new Date).getTime()+n++},o=function(e){return"["+e+"]$1"},a=function(e){return"_"+e+"_$1"},i=function(n,t,o){return n?"function"==typeof n?(t&&console.warn("association-insertion-traversal is ignored, because association-insertion-node is given as a function."),n(o)):"string"==typeof n?t?o[t](n):"this"==n?o:e(n):void 0:o.parent()};e(document).on("click",".add_fields",function(n){n.preventDefault();var s=e(this),r=s.data("association"),c=s.data("associations"),d=s.data("association-insertion-template"),l=s.data("association-insertion-method")||s.data("association-insertion-position")||"before",u=s.data("association-insertion-node"),f=s.data("association-insertion-traversal"),p=parseInt(s.data("count"),10),g=new RegExp("\\[new_"+r+"\\](.*?\\s)","g"),v=new RegExp("_new_"+r+"_(\\w*)","g"),m=t(),_=d.replace(g,o(m)),h=[];for(_==d&&(g=new RegExp("\\[new_"+c+"\\](.*?\\s)","g"),v=new RegExp("_new_"+c+"_(\\w*)","g"),_=d.replace(g,o(m))),_=_.replace(v,a(m)),h=[_],p=isNaN(p)?1:Math.max(p,1),p-=1;p;)m=t(),_=d.replace(g,o(m)),_=_.replace(v,a(m)),h.push(_),p-=1;var w=i(u,f,s);w&&0!=w.length||console.warn("Couldn't find the element to insert the template. Make sure your `data-association-insertion-*` on `link_to_add_association` is correct."),e.each(h,function(n,t){var o=e(t);w.trigger("cocoon:before-insert",[o]);w[l](o);w.trigger("cocoon:after-insert",[o])})}),e(document).on("click",".remove_fields.dynamic, .remove_fields.existing",function(n){var t=e(this),o=t.data("wrapper-class")||"nested-fields",a=t.closest("."+o),i=a.parent();n.preventDefault(),i.trigger("cocoon:before-remove",[a]);var s=i.data("remove-timeout")||0;setTimeout(function(){t.hasClass("dynamic")?a.remove():(t.prev("input[type=hidden]").val("1"),a.hide()),i.trigger("cocoon:after-remove",[a])},s)}),e(document).on("ready page:load",function(){e(".remove_fields.existing.destroyed").each(function(){var n=e(this),t=n.data("wrapper-class")||"nested-fields";n.closest("."+t).hide()})})}(jQuery);